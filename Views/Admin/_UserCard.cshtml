@model JobExchangeMvc.DTOs.ProfileDto

<div class="card h-100 shadow-sm user-card">
    <div class="card-body">
        <!-- Avatar -->
        <div class="text-center mb-3">
            @if (!string.IsNullOrEmpty(Model.AvatarUrl))
            {
                <img src="@Model.AvatarUrl" alt="@Model.FullName" class="rounded-circle" width="80" height="80">
            }
            else
            {
                <i class="fas fa-user-circle fa-5x text-muted"></i>
            }
        </div>

        <!-- User Info -->
        <h5 class="card-title text-center mb-2">@Model.FullName</h5>
        <p class="text-center text-muted small mb-3">
            <i class="fas fa-envelope"></i> @Model.Email
        </p>

        <!-- Role Badge -->
        <div class="text-center mb-3">
            @if (Model.Role == "Admin")
            {
                <span class="badge bg-danger"><i class="fas fa-user-shield"></i> Admin</span>
            }
            else if (Model.Role == "Employer")
            {
                <span class="badge bg-primary"><i class="fas fa-building"></i> Nhà tuyển dụng</span>
            }
            else
            {
                <span class="badge bg-success"><i class="fas fa-user"></i> Ứng viên</span>
            }

            @if (Model.IsActive)
            {
                <span class="badge bg-success ms-1"><i class="fas fa-check-circle"></i> Active</span>
            }
            else
            {
                <span class="badge bg-secondary ms-1"><i class="fas fa-ban"></i> Inactive</span>
            }
        </div>

        <!-- Details -->
        <div class="mb-3">
            @if (!string.IsNullOrEmpty(Model.PhoneNumber))
            {
                <p class="mb-1 small">
                    <i class="fas fa-phone text-primary"></i> @Model.PhoneNumber
                </p>
            }

            <p class="mb-1 small">
                <i class="fas fa-calendar-alt text-info"></i> 
                Ngày tạo: @Model.CreatedAt.ToString("dd/MM/yyyy")
            </p>

            @if (Model.Role == "Employer" && !string.IsNullOrEmpty(Model.CompanyName))
            {
                <p class="mb-1 small">
                    <i class="fas fa-building text-warning"></i> @Model.CompanyName
                </p>
            }
        </div>

        <!-- VerifyKey Section (Encrypted) -->
        @if (!string.IsNullOrEmpty(Model.VerifyKey))
        {
            <div class="alert alert-light border mb-3">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <small class="text-muted d-block mb-1">
                            <i class="fas fa-key"></i> VerifyKey (mã hóa):
                        </small>
                        <code class="encrypted-key small" data-user-id="@Model.Id">
                            @(Model.VerifyKey.Length > 20 ? Model.VerifyKey.Substring(0, 20) + "..." : Model.VerifyKey)
                        </code>
                    </div>
                    <button type="button" class="btn btn-sm btn-outline-primary btn-show-verify-key" 
                            data-id="@Model.Id" 
                            title="Xem VerifyKey gốc">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>
        }

        <!-- Actions -->
        <div class="d-grid gap-2">
            <a href="#" class="btn btn-sm btn-outline-primary" 
               data-bs-toggle="modal" data-bs-target="#userDetailModal@(Model.Id)">
                <i class="fas fa-info-circle"></i> Chi tiết
            </a>
            
            @if (Model.IsActive)
            {
                <form asp-controller="Admin" asp-action="ToggleUserStatus" method="post" class="d-inline">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="userId" value="@Model.Id" />
                    <button type="submit" class="btn btn-sm btn-outline-danger w-100" 
                            onclick="return confirm('Bạn có chắc muốn vô hiệu hóa user này?')">
                        <i class="fas fa-ban"></i> Vô hiệu hóa
                    </button>
                </form>
            }
            else
            {
                <form asp-controller="Admin" asp-action="ToggleUserStatus" method="post" class="d-inline">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="userId" value="@Model.Id" />
                    <button type="submit" class="btn btn-sm btn-outline-success w-100">
                        <i class="fas fa-check-circle"></i> Kích hoạt
                    </button>
                </form>
            }
        </div>
    </div>
</div>

<!-- User Detail Modal -->
<div class="modal fade" id="userDetailModal@(Model.Id)" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-user"></i> Chi tiết: @Model.FullName
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <dl class="row">
                    <dt class="col-sm-4">ID:</dt>
                    <dd class="col-sm-8">@Model.Id</dd>

                    <dt class="col-sm-4">Email:</dt>
                    <dd class="col-sm-8">@Model.Email</dd>

                    <dt class="col-sm-4">Họ tên:</dt>
                    <dd class="col-sm-8">@Model.FullName</dd>

                    <dt class="col-sm-4">Điện thoại:</dt>
                    <dd class="col-sm-8">@(Model.PhoneNumber ?? "Chưa cập nhật")</dd>

                    <dt class="col-sm-4">Vai trò:</dt>
                    <dd class="col-sm-8">@Model.Role</dd>

                    <dt class="col-sm-4">Trạng thái:</dt>
                    <dd class="col-sm-8">
                        @if (Model.IsActive)
                        {
                            <span class="badge bg-success">Đang hoạt động</span>
                        }
                        else
                        {
                            <span class="badge bg-secondary">Đã vô hiệu hóa</span>
                        }
                    </dd>

                    <dt class="col-sm-4">Ngày tạo:</dt>
                    <dd class="col-sm-8">@Model.CreatedAt.ToString("dd/MM/yyyy HH:mm")</dd>

                    @if (!string.IsNullOrEmpty(Model.Skills))
                    {
                        <dt class="col-sm-4">Kỹ năng:</dt>
                        <dd class="col-sm-8">@Model.Skills</dd>
                    }

                    @if (!string.IsNullOrEmpty(Model.Bio))
                    {
                        <dt class="col-sm-4">Giới thiệu:</dt>
                        <dd class="col-sm-8">@Model.Bio</dd>
                    }
                </dl>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>
